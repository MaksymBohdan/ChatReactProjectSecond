1
00:00:01,150 --> 00:00:06,330
Now work on adding notifications to our public channels when we're in one channel but see that other

2
00:00:06,330 --> 00:00:14,580
messages are added to a channel that we're not on we'll begin by going to our channels component

3
00:00:17,910 --> 00:00:27,270
and we'll first create a property in St. Paul Channel initially set to now also create a message is

4
00:00:27,270 --> 00:00:30,560
read referencing our messages collection

5
00:00:33,550 --> 00:00:40,960
as well as notifications property set to an empty array.

6
00:00:41,190 --> 00:00:45,500
We'll head down to change channel and with the channel that's being passed and are going to set the

7
00:00:45,500 --> 00:00:51,440
state and update the channel value that we just created.

8
00:00:55,630 --> 00:01:06,840
We'll execute a new function within our ADD listeners function that'll take the ID of every channel

9
00:01:06,840 --> 00:01:12,900
that's added to the channels ref will snacky this function will be called add notification listener

10
00:01:14,880 --> 00:01:20,770
Ill accept snap key as Channel ID.

11
00:01:20,770 --> 00:01:22,590
This will allow us to take the messages.

12
00:01:23,050 --> 00:01:28,680
Channel ID as a child on it and listen for any value changes meaning listen for any new messages added

13
00:01:29,040 --> 00:01:35,520
to any of our channels and if we have a value for that channel property within state that we just created

14
00:01:36,600 --> 00:01:39,130
if the user has changed the channel they're on.

15
00:01:39,400 --> 00:01:45,210
Going to show them the number of messages that are new and the other channels that they're not on.

16
00:01:45,210 --> 00:01:49,680
By executing this function handle notifications will take the channel ID.

17
00:01:49,680 --> 00:01:53,900
The idea of the channel and state the notifications are and state and the entire snap

18
00:01:57,010 --> 00:02:03,220
and now I'm creating this channel notifications function will call these parameters channel ID the current

19
00:02:03,220 --> 00:02:12,580
channel ID the one stored in state notifications and snap or first create this last total variable setting

20
00:02:12,640 --> 00:02:18,190
equal to zero then will iterate over the notifications array that we're getting from state use find

21
00:02:18,190 --> 00:02:19,500
index to do so.

22
00:02:19,660 --> 00:02:27,310
We want to find index value for an array element within the notifications or a which has an id property

23
00:02:27,310 --> 00:02:28,650
that's equal to channel ID.

24
00:02:28,690 --> 00:02:36,640
So we want to see if we have any information about a given channel.

25
00:02:36,710 --> 00:02:45,740
So if we don't if the index is equal to negative one from fine index we want to push a new array element

26
00:02:45,740 --> 00:02:47,350
onto our notifications right.

27
00:02:47,500 --> 00:02:54,860
And this will be an object which will first contain an id property set to channel ID a total value set

28
00:02:54,950 --> 00:03:00,950
to snapshot some children to get the total number of messages for a given channel.

29
00:03:01,310 --> 00:03:07,460
Last known total the same value and account property set initially to zero but which we'll update to

30
00:03:07,790 --> 00:03:10,670
get our final total of notifications.

31
00:03:11,780 --> 00:03:17,420
So now if we do have an index value for a given channel one to make sure it's not equal to the current

32
00:03:17,420 --> 00:03:18,270
channel ID.

33
00:03:18,800 --> 00:03:28,750
And now we'll update the last total value using the total value from the given array element then we'll

34
00:03:28,750 --> 00:03:34,780
get the most recent number of messages for a given channel with snapped on some children subtracted

35
00:03:34,840 --> 00:03:35,890
by the last total.

36
00:03:36,040 --> 00:03:41,350
And if it's greater than zero if there is a new message or multiple messages added to a given channel

37
00:03:41,620 --> 00:03:51,370
we're going to update the Count property for a given element with snap that children minus last total.

38
00:03:51,890 --> 00:03:53,920
So that should be the number of new messages.

39
00:03:55,550 --> 00:04:04,670
We're given channel and then at the very end we'll update the last known total with snapchat name children.

40
00:04:04,780 --> 00:04:10,960
And finally when the message listener has been executed after firing off a message we've run our conditional

41
00:04:11,410 --> 00:04:18,700
we want to update the notifications right and state so save that head back to our app and test this

42
00:04:18,700 --> 00:04:19,600
out.

43
00:04:19,600 --> 00:04:25,330
First we need to make sure that we switch to a different channel so that we have a channel value within

44
00:04:25,330 --> 00:04:26,440
our state.

45
00:04:26,440 --> 00:04:32,350
Remember that our handle notifications function will only run if we have a non-null value for our channel

46
00:04:32,590 --> 00:04:39,600
then state by switching to another channel will navigate to channels component in depth tools.

47
00:04:39,630 --> 00:04:44,400
Take a look at the notifications right now if we add a new message to the second channel I can see a

48
00:04:44,400 --> 00:04:49,300
new element was added to the array an object with the properties total last known total.

49
00:04:49,320 --> 00:04:54,150
The idea of the channel as well as the count and the counters set to zero since the current channel

50
00:04:54,150 --> 00:04:56,640
ID and the channel ID are the same.

51
00:04:56,640 --> 00:04:58,390
We're not going to see any notifications.

52
00:04:58,530 --> 00:05:05,790
Since we're on that same channel and we added the message ourselves out when we changed the channel

53
00:05:05,790 --> 00:05:11,030
that we're on we want to execute a function called Clear notifications and clear notifications.

54
00:05:12,070 --> 00:05:18,570
Will remove any notifications that we're getting for a channel that we're currently on if we see that

55
00:05:18,570 --> 00:05:22,770
there are new messages and we take a look at those messages obviously we don't want to be notified about

56
00:05:22,770 --> 00:05:23,670
them anymore.

57
00:05:24,000 --> 00:05:29,670
So once again take the notifications or iterate over it using find index method We'll check to see if

58
00:05:29,670 --> 00:05:36,600
there is an id property whose value is equal to the channel that we have stored in state it's ID value.

59
00:05:37,050 --> 00:05:43,170
And if it finds a positive index number for it it's not equal to negative 1.

60
00:05:43,230 --> 00:05:51,840
We're going to copy the notifications reinstate inserted equal to a variable updated notifications and

61
00:05:51,840 --> 00:05:58,470
we'll use the array spread operator in order to copy that array will take updated notifications and

62
00:05:58,470 --> 00:06:05,250
select an element based on that index grab its total value of notifications and we want to update this

63
00:06:05,430 --> 00:06:14,100
one to update it by taking the notifications or in-state selecting an element based on the index value

64
00:06:14,100 --> 00:06:18,900
that we found and updating it with the last known total value.

65
00:06:21,610 --> 00:06:29,520
And then we want to take the Count property and set that equal to zero.

66
00:06:29,580 --> 00:06:36,750
Then finally we want to settle on a vacation and stay with our new updated notifications variable.

67
00:06:37,230 --> 00:06:41,190
Now that we've done all this work for getting the count of new messages and other channels we want to

68
00:06:41,190 --> 00:06:46,940
display it we'll do that within display channels or execute a function called get notification count.

69
00:06:47,250 --> 00:06:53,010
It'll take the channel that's being iterated over and if the value returned is true or truth the are

70
00:06:53,010 --> 00:07:01,820
going to display a label component from semantic UI with the color red and within it will interpolate

71
00:07:02,490 --> 00:07:07,710
the number of new messages with getting notification count once again passing in the channel.

72
00:07:08,100 --> 00:07:15,610
So make sure to bring in the label component from semantic UI and we'll create this new function

73
00:07:23,570 --> 00:07:32,740
and get notification count takes the channel being iterated over will create account variables that

74
00:07:32,740 --> 00:07:40,570
initially zero will take the notifications are in state no user for each to iterate over it for each

75
00:07:40,570 --> 00:07:41,460
notification element.

76
00:07:41,470 --> 00:07:50,840
We want to check to see first of all if the ID on the element is equal the channel got ID.

77
00:07:50,920 --> 00:07:58,990
If so we'll update the count variable the Count property on the notification element.

78
00:07:59,070 --> 00:08:03,700
And lastly we want to check to make sure that the account number is greater than zero.

79
00:08:03,780 --> 00:08:10,800
If so or return that number and this way that as the number of new messages within this label component

80
00:08:11,730 --> 00:08:19,020
next to our channel So save all that and optionally if we want to get notifications about new messages

81
00:08:19,020 --> 00:08:25,730
added to other channels without having to first switch the channel we can within the first channel function.

82
00:08:25,950 --> 00:08:31,800
Set the stage set the channel properly and states to first channel then work my terminal.

83
00:08:31,800 --> 00:08:41,930
We're going to deploy my app with the now Seelye to test this out and once it's been deployed going

84
00:08:41,980 --> 00:08:45,650
apace the deployed you're all that I get into a new town

85
00:08:49,020 --> 00:08:56,770
and bring it to the side so I can log in with a different user and cast out our notification functionality.

86
00:09:02,110 --> 00:09:05,690
So switch to the Riak channel type in a new message.

87
00:09:05,770 --> 00:09:11,650
Once I hit ad reply you can see the notification for one new message added to the Riak channel for my

88
00:09:11,650 --> 00:09:14,010
first user by Taipan.

89
00:09:14,010 --> 00:09:15,240
Now to another message.

90
00:09:15,240 --> 00:09:17,220
And see that's updated to two.

91
00:09:17,750 --> 00:09:21,180
And the web server by ADD or apply.

92
00:09:21,400 --> 00:09:26,510
You can see that notifications added to the deployed euro.

93
00:09:26,510 --> 00:09:32,920
And if we visit both of these channels you can see that the number the count of new messages is cleared

94
00:09:32,920 --> 00:09:33,620
out.

95
00:09:33,700 --> 00:09:34,390
When we visited.

