1
00:00:00,620 --> 00:00:06,450
We're now cropping the preview image that we have for our avatar now we want to enable the functionality

2
00:00:06,450 --> 00:00:13,180
for change Avatar button to actually change the image that's associated with a given user.

3
00:00:15,060 --> 00:00:26,280
So I hadn't unclick to our change our carbon which reference a new function called upload cropped image.

4
00:00:26,370 --> 00:00:31,850
So as the name suggests it will upload the image of a user's cropped to firebase storage

5
00:00:35,470 --> 00:00:36,630
so create this function.

6
00:00:39,200 --> 00:00:46,430
And in order to upload her image will need to reference our storage and firebase with a storage rackin

7
00:00:46,460 --> 00:00:46,790
state

8
00:00:49,810 --> 00:00:52,990
which I'll use firebase of storage and NMT RATH

9
00:00:58,680 --> 00:01:11,330
So we'll use this storage to and above it we can structure it from state to the path to it is just storage

10
00:01:11,350 --> 00:01:11,530
raw

11
00:01:14,970 --> 00:01:17,030
and we want to put a child on it.

12
00:01:19,960 --> 00:01:27,250
And we'll use some template literals to reference Avatar's flash user dash and then we'll interpret

13
00:01:28,060 --> 00:01:37,000
the current user ID and instead of getting the current user information from prop's we're going to create

14
00:01:37,000 --> 00:01:41,780
a user app which is going to reference 5 based on our current user.

15
00:01:42,190 --> 00:01:52,830
And this is an alternate way to get the current users de-value we can restructure user from state and

16
00:01:52,920 --> 00:02:01,910
get their ID with user after UAD we use the put method to put our image in firebase storage.

17
00:02:02,080 --> 00:02:07,120
We want to grab the blog from state and also put some associated metadata with it.

18
00:02:07,120 --> 00:02:14,030
So create a meta data object and state which will have a content type property with the file type image

19
00:02:14,050 --> 00:02:18,890
flash JPEG with this meta data object.

20
00:02:19,060 --> 00:02:27,810
We're going to be uploading all of our images as JPEG files were added then after executing put.

21
00:02:28,220 --> 00:02:33,040
Are we going to get a snap back after uploading or image and on the property we're going to execute

22
00:02:33,040 --> 00:02:35,750
the get download euro method.

23
00:02:35,990 --> 00:02:42,250
We'll add it then since this is a promise or we'll get the download Eurail from firebase storage and

24
00:02:42,250 --> 00:02:49,050
we want to set the property in state called uploaded cropped image with the download euro.

25
00:02:49,620 --> 00:02:55,220
It will create uploaded cropped image within our state

26
00:03:03,290 --> 00:03:10,600
and within the callback we're setting this property romantical a function called Change Avatar.

27
00:03:11,360 --> 00:03:12,850
So at this point we've done the first part.

28
00:03:12,850 --> 00:03:19,990
We've uploaded an image to firebase storage as an image blob and then change avatar.

29
00:03:20,120 --> 00:03:32,590
We're going to first take this user that we have and call the up to profile method on its in order to

30
00:03:32,800 --> 00:03:35,620
update our users photo euro property

31
00:03:38,780 --> 00:03:46,030
and we'll update it with the download bureau that's within this art center uploaded cropped image.

32
00:03:46,100 --> 00:03:48,860
Why then since this is a promise or will log

33
00:03:51,630 --> 00:03:53,130
go to your all updated

34
00:03:57,420 --> 00:04:06,600
and we'll close the model and we'll catch any errors with catch.

35
00:04:06,900 --> 00:04:16,080
And in addition to updating a user's profile with the user we want to update their associated data on

36
00:04:16,080 --> 00:04:28,370
our users RAF in our firebase database or create a user's property referencing firebase database and

37
00:04:28,380 --> 00:04:29,490
the users collection

38
00:04:36,450 --> 00:04:44,910
will set a child on the user to get the logged in user.

39
00:04:45,320 --> 00:04:54,250
When I use this that's data you ID you want to update their information and specifically the Avatar

40
00:04:54,280 --> 00:05:02,530
property with this does data uploaded cropped image and then if that returned successfully

41
00:05:05,240 --> 00:05:08,050
will get a logo user Avatar updated.

42
00:05:08,170 --> 00:05:11,840
And once again we'll catch any errors.

43
00:05:14,390 --> 00:05:16,160
We'll save all of our files.

44
00:05:18,840 --> 00:05:25,760
Also make sure to restructure the metadata property state within upload cropped image.

45
00:05:25,890 --> 00:05:26,790
If you haven't already

46
00:05:30,600 --> 00:05:36,210
will try going through the entire process of changing our avatar will select Change Avatar will choose

47
00:05:36,210 --> 00:05:37,080
a new image file

48
00:05:40,810 --> 00:05:50,200
will select the crop that we want and we'll hit preview and finally will click on change avatar and

49
00:05:50,200 --> 00:05:57,760
you can see immediately within our avatar image and our user panel that the Avatar was changed.

50
00:05:57,760 --> 00:06:02,140
We see both of our logs user Avatar updated 40 updated.

51
00:06:02,560 --> 00:06:09,190
If we take a look at the data we're currently authenticated using our database we should see that the

52
00:06:09,190 --> 00:06:14,740
Avatar euro now references firebase storage.

53
00:06:15,050 --> 00:06:26,500
If we take a look at our storage we should see a new folder of avatars we click on that we see user

54
00:06:26,500 --> 00:06:35,970
dash and then some cryptic string and there we should find the image that we uploaded our cropped image.

55
00:06:36,060 --> 00:06:41,440
You can see its name size the type of image size JPEG when it was created.

56
00:06:42,130 --> 00:06:49,210
And now if we try adding a new message to one of our channels we can see our new avatar next to our

57
00:06:49,210 --> 00:06:49,660
message.

