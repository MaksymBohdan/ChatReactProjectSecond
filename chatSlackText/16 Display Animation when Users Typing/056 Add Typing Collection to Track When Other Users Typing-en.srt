1
00:00:00,600 --> 00:00:06,360
When other users are typing in the same challenge that we're currently in it be nice to see an animation

2
00:00:06,810 --> 00:00:11,790
at the very bottom of the given channel in order to see that they're preparing a message.

3
00:00:11,790 --> 00:00:19,030
Other users are preparing a message so head to our message form component and we'll begin by adding

4
00:00:19,030 --> 00:00:27,110
an on key down handler to our message and put this whole reference a new function called handle key

5
00:00:27,110 --> 00:00:27,660
down.

6
00:00:31,660 --> 00:00:38,110
So create or handle key don't function say underneath handle change handle key down will be a bit different

7
00:00:38,120 --> 00:00:45,580
it won't take an event but it will first check to see if we have some value stored in our message property

8
00:00:45,580 --> 00:00:46,770
of state.

9
00:00:46,810 --> 00:00:48,370
We can structure that from state.

10
00:00:48,550 --> 00:00:56,440
Then the function then will access a typing Raf's so create a new property within state called typing.

11
00:00:56,710 --> 00:00:58,040
The sole reference.

12
00:00:58,040 --> 00:01:04,980
A new collection in our database we haven't used before with the name of typing assigned to it.

13
00:01:08,560 --> 00:01:11,690
We can grab that from state as well.

14
00:01:11,690 --> 00:01:17,650
It'll have a child set equal to the channel ID that we're currently in.

15
00:01:19,980 --> 00:01:29,310
And another child with the User ID would make sure that the structure that is well from state and nested

16
00:01:29,310 --> 00:01:38,220
within these two children are going to set a value of user data display name so the users name if they're

17
00:01:38,220 --> 00:01:42,310
currently typing in a given channel.

18
00:01:42,330 --> 00:01:43,980
Otherwise if we don't have a message

19
00:01:46,810 --> 00:01:52,970
we're going to remove that value that we just said on the typing Ralph

20
00:01:56,070 --> 00:01:59,340
So to test this out or type into a given channel.

21
00:01:59,560 --> 00:02:00,760
Take a look at our database.

22
00:02:00,790 --> 00:02:07,000
We should see a new typing collection with the channel ID within that the user id and the name of the

23
00:02:07,000 --> 00:02:08,140
user.

24
00:02:08,380 --> 00:02:15,580
And once we remove everything from the message input we remove all the text we should see that typing

25
00:02:15,580 --> 00:02:20,580
collection removed entirely.

26
00:02:20,820 --> 00:02:26,060
And when we're sending a message of course the current user is no longer typing.

27
00:02:26,280 --> 00:02:37,860
So within then once we successfully sent off a message we want to remove the typing RAF that references

28
00:02:38,970 --> 00:02:39,810
the current user

29
00:02:42,820 --> 00:02:46,860
and the structure user from state within send a message as well as the typing route.

30
00:02:47,320 --> 00:02:55,420
When we change the channel we want to remove the typing ref as well for a given user.

31
00:02:55,510 --> 00:03:04,490
So then change channel and our channels component will recognize the typing raw from state passen the

32
00:03:04,490 --> 00:03:11,660
channel ID to the first child user ID to the second child and use the Remove method again and within

33
00:03:11,660 --> 00:03:15,110
channels of course we need to first create the typing graph.

34
00:03:17,830 --> 00:03:24,270
So if we change a channel or obviously no longer typing in the channel we were previously in.

35
00:03:25,070 --> 00:03:30,280
So thats why its being removed now to test both of these cases out first.

36
00:03:31,140 --> 00:03:37,910
Type into our input we see our typing collection we send a message.

37
00:03:37,910 --> 00:03:46,960
We see that that is removed for our current user we type in again we see the added we switch to a different

38
00:03:46,960 --> 00:03:47,810
channel.

39
00:03:47,980 --> 00:03:50,770
We see that the entire collection is removed.

40
00:03:50,770 --> 00:03:55,360
So this is the approach that we'll use to determine if other users are typing in the same channel that

41
00:03:55,370 --> 00:03:56,400
we're currently in.

