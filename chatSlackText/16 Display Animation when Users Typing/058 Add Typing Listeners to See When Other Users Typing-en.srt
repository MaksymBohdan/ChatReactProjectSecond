1
00:00:00,570 --> 00:00:02,610
We've created our typing component.

2
00:00:02,610 --> 00:00:08,880
Now we want to display this component for every user that's typing within the same channel that are

3
00:00:08,880 --> 00:00:18,010
currently authenticated user in so out and execute a new listener function and add listeners and our

4
00:00:18,010 --> 00:00:24,400
messages component called add typing listeners will accept the channel ID.

5
00:00:24,760 --> 00:00:32,800
And within this function or first create an array called Taiping users to collect all the users typing

6
00:00:32,800 --> 00:00:35,710
within a given channel based on its ID.

7
00:00:36,760 --> 00:00:44,250
So on the state object we'll add our typing graph referencing firebase to our database and ref with

8
00:00:44,380 --> 00:00:54,560
the string of typing will take this not state that typing graph will pass channel ID as a child to it

9
00:00:55,220 --> 00:01:07,730
and listen for the child at an event and within unsnap or first check to see if a snapshot key is not

10
00:01:07,760 --> 00:01:17,600
equal to this start state that user ID and were performing this check to make sure that were not collecting

11
00:01:17,870 --> 00:01:21,620
the currently authenticated user within this typing users.

12
00:01:22,040 --> 00:01:29,100
We use the concat method to concatenate an object on the end of the array with an ID set to snapped

13
00:01:29,150 --> 00:01:29,570
key

14
00:01:33,650 --> 00:01:35,980
and a name property set the snapshot value.

15
00:01:36,090 --> 00:01:44,870
So we're collecting the user's ID and their name and we're redesigning the typing user's array and we'll

16
00:01:44,870 --> 00:01:49,210
set state will set our typing users array within state.

17
00:01:49,370 --> 00:01:54,680
So we need to create this new property initially set to an empty array

18
00:02:00,200 --> 00:02:04,330
and also have an addition to our child added event.

19
00:02:04,400 --> 00:02:05,030
We're going to have

20
00:02:08,050 --> 00:02:14,420
our child removed event with the same child channel ID on our typing.

21
00:02:17,550 --> 00:02:23,910
And within a snap callback we're going to take the typing users are they going to use the find index

22
00:02:23,910 --> 00:02:33,020
method which will iterate over every user element we want to compare the user id property with snapshot

23
00:02:33,030 --> 00:02:39,200
key and if there is none index value that's positive.

24
00:02:39,450 --> 00:02:44,540
If an index can't be found We're going to use the filter method.

25
00:02:46,500 --> 00:02:55,350
Or will iterate once again over the Taiping uses array and will make sure that none of the Ids within

26
00:02:55,350 --> 00:03:03,540
each of these elements is equal to Samter key or reassign the typing user's array once again and set

27
00:03:03,540 --> 00:03:04,840
the state.

28
00:03:05,490 --> 00:03:11,550
Now that we're listening for children being added or removed from our typing ref we're going to once

29
00:03:11,550 --> 00:03:20,710
again use the connected graph to determine whether a user is online or not and that all reference firebase

30
00:03:20,710 --> 00:03:25,350
to database Aref the text in post-blast connected

31
00:03:29,400 --> 00:03:41,170
will take the connected from say listen for a value change and within the snap callback will first check

32
00:03:41,170 --> 00:03:45,640
to see if sample values equal to true.

33
00:03:45,790 --> 00:04:00,640
Then we'll take the Taiping graph will take a child on it of the channel ID a child with the current

34
00:04:00,640 --> 00:04:05,980
users user ID will add the on disconnect method.

35
00:04:08,830 --> 00:04:10,910
And to also add remove.

36
00:04:11,290 --> 00:04:20,460
So when are currently authenticated user logs out there child value on the typing half will be removed.

37
00:04:22,280 --> 00:04:23,510
Now we'll head down to render

38
00:04:26,610 --> 00:04:35,100
and first of all these structure Taiping users from St. and then head down to our div we were out where

39
00:04:35,100 --> 00:04:41,310
we were outputting the span of the text that we provided as well as our typing component and replace

40
00:04:41,310 --> 00:04:48,480
that with a call to a new function called display typing users where we'll pass the typing users or

41
00:04:48,480 --> 00:04:51,440
a few.

42
00:04:51,480 --> 00:04:58,350
We want to iterate over all of the elements in this typing user's array and state.

43
00:04:58,650 --> 00:05:02,600
We first want to check to make sure the length of that array is greater than zero.

44
00:05:02,640 --> 00:05:12,090
If so we'll map over it with the map method and we'll paste in the market that we copied

45
00:05:14,850 --> 00:05:16,940
or will change.

46
00:05:16,980 --> 00:05:23,760
First of all the style prop to include a margin bottom rule 0.2 EMS

47
00:05:26,660 --> 00:05:41,080
and give it a key prop said to use or not ID or place the hardcoded username with user data name.

48
00:05:41,270 --> 00:05:54,440
We'll save our changes and once again all deploy my app with the now Selye and once it's deployed are

49
00:05:54,530 --> 00:05:57,950
paste in the deployed euro to different tab

50
00:06:01,250 --> 00:06:07,940
and bring this over to the side we'll sign in with a different user than the one currently authenticated

51
00:06:07,940 --> 00:06:10,790
in our dev server.

52
00:06:13,130 --> 00:06:21,340
We'll make sure when I'm on the same channel or react you can see now we have our typing animations

53
00:06:21,340 --> 00:06:30,000
saying that Thomas is typing and there are other user types in Thomas's page.

54
00:06:30,010 --> 00:06:33,120
You can see that Douglas is typing.

55
00:06:33,790 --> 00:06:39,040
We can remove this animation if we clear our message input and if we start typing again.

56
00:06:40,170 --> 00:06:44,520
And see it again if we post or message typing animation goes away.

57
00:06:44,520 --> 00:06:50,060
And the same for other user.

58
00:06:50,250 --> 00:06:52,690
We switch back to another channel.

59
00:06:52,710 --> 00:06:57,990
You'll see that we only see that typing animation when our users are on the same channel.

60
00:07:00,970 --> 00:07:05,980
So now we've got our functionality to display when other users in the same channel are typing.

